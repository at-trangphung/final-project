<% content_for :title, 'Shop Cafe' %>
<% content_for :script, javascript_include_tag(:shop) %>

<div class="row featuredPostContainer style2">
  <h3 class="section-title style2 text-center">
    <span>SUGGEST PRODUCTs</span>
  </h3>
  <div class="row  categoryProduct xsResponse clearfix">
    <% @productSuggest.each do |product| %>
      <div class="item col-sm-4 col-lg-4 col-md-4 col-xs-6" 
        style="height: 476px; display: flex;">
        <div class="product">
          <% if @service_user.current_user %>
            <% if @service_favorite.check_like(@service_user.current_user.id, product.id).nil? %>
              <div class="favorite"
                id="product_<%= product.id %>", style= "width: 50px;">
                <%= form_with(url: favorites_path, method: :post, local: true) do |form| %>
                  <%= form.hidden_field :user_id, 
                    value: @service_user.current_user.id %>
                  <%= form.hidden_field :product_id, value: product.id %>
                  <button type="submit">
                    <i class="far fa-heart"></i>
                    <span><%= product.view ? product.view : 0 %></span>
                  </button>
                <% end %>
              </div>
            <% else %>
              <div class="favorite"
                id="product_<%= product.id %>">
                <%= form_with(url: favorite_path(@service_favorite.check_like(
                  @service_user.current_user.id, product.id)), method: :delete,local: true) do |form| %>
                  <%= form.hidden_field :user_id, value: @service_user.current_user.id %>
                  <%= form.hidden_field :product_id, value: product.id %>
                  <button type="submit">
                    <i class="fas fa-heart"></i>
                    <span><%= product.view ? product.view : 0 %></span>
                  </button>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <div class="favorite">
              <button type="submit" disabled>
                <i class="fas fa-heart"></i>
                <span><%= product.view ? product.view : 0 %></span>
              </button>
            </div>  
          <% end %>
          <div class="image" style="height: 200px; width: 260px">
            <%= link_to product_path(product) do %>
              <%= cl_image_tag product.image_link, alt: 'img',  height: "200px",
                width: "262px"  %>
            <% end %>
            <div class="promotion"><span class="new-product"> NEW</span><%#= product.discount%></div>
          </div>
          <div class="description">
            <h4><%= product.name %></h4>
              <p><%= product.description%></p>
            <span class="size"><%= product.sizes.first.name %></span>
          </div>
          <div class="price">
            <span class="price"><%= product.product_options.first.price %>$
            </span>
          </div>
          <div class="action-control">
            <%= form_with scope: :cart, url: carts_path, local: true do |form| %>
              <%= form.hidden_field :price, value: product.product_options.first.price %>
              <%= form.hidden_field :size, value: product.sizes.first.name %>
              <%= form.hidden_field :type, value: product.types.first.name %>
              <%= form.hidden_field :product_id, value: product.id %>
              <%= form.hidden_field :quantity, value: 1 %>
              <%= form.submit 'Add to Cart', class: 'btn btn-primary' %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div> 
</div>
<div class="w100 productFilter clearfix">
  <p class="pull-left"> Showing <strong><%= @productList.length %></strong> products </p>

  <div class="pull-right ">
    <div class="change-order pull-right">
      <select class="form-control" name="orderby">
        <option selected="selected">Default sorting</option>
        <option value="popularity">Sort by popularity</option>
        <option value="rating">Sort by average rating</option>
        <option value="date">Sort by newness</option>
        <option value="price">Sort by price: low to high</option>
        <option value="price-desc">Sort by price: high to low</option>
      </select>
    </div>
    <div class="change-view pull-right"><a href="#" title="Grid" class="grid-view"> <i class="fa fa-th-large"></i> </a> <a href="#" title="List" class="list-view "><i class="fa fa-th-list"></i></a></div>
  </div>
</div>
<div class="row featuredPostContainer style2">
  <h3 class="section-title style2 text-center">
    <span>LIST PRODUCTs</span>
  </h3>
  <div class="row  categoryProduct xsResponse clearfix">
    <% @productList.each do |product| %>
      <div class="item col-sm-4 col-lg-4 col-md-4 col-xs-6" 
        style="height: 476px; display: flex;">
        <div class="product">
          <% if @service_user.current_user %>
            <% if @service_favorite.check_like(@service_user.current_user.id, product.id).nil? %>
              <div class="favorite"
                id="product_<%= product.id %>", style= "width: 50px;">
                <%= form_with(url: favorites_path, method: :post, local: true) do |form| %>
                  <%= form.hidden_field :user_id, 
                    value: @service_user.current_user.id %>
                  <%= form.hidden_field :product_id, value: product.id %>
                  <button type="submit">
                    <i class="far fa-heart"></i>
                    <span><%= product.view ? product.view : 0 %></span>
                  </button>
                <% end %>
              </div>
            <% else %>
              <div class="favorite"
                id="product_<%= product.id %>">
                <%= form_with(url: favorite_path(@service_favorite.check_like(
                  @service_user.current_user.id, product.id)), method: :delete,local: true) do |form| %>
                  <%= form.hidden_field :user_id, value: @service_user.current_user.id %>
                  <%= form.hidden_field :product_id, value: product.id %>
                  <button type="submit">
                    <i class="fas fa-heart"></i>
                    <span><%= product.view ? product.view : 0 %></span>
                  </button>
                <% end %>
              </div>
            <% end %>
          <% else %>
            <div class="favorite">
              <button type="submit" disabled>
                <i class="fas fa-heart"></i>
                <span><%= product.view ? product.view : 0 %></span>
              </button>
            </div>  
          <% end %>
          <div class="image" style="height: 200px; width: 260px">
            <%= link_to product_path(product) do %>
              <%= cl_image_tag product.image_link, alt: 'img',  height: "200px",
                width: "262px"  %>
            <% end %>
            <div class="promotion"><span class="new-product"> NEW</span><%#= product.discount%></div>
          </div>
          <div class="description">
            <h4><%= product.name %></h4>
              <p><%= product.description%></p>
            <span class="size"><%= product.sizes.first.name %></span>
          </div>
          <div class="price">
            <span class="price"><%= product.product_options.first.price %>$
            </span>
          </div>
          <div class="action-control">
            <%= form_with scope: :cart, url: carts_path, local: true do |form| %>
              <%= form.hidden_field :price, value: product.product_options.first.price %>
              <%= form.hidden_field :size, value: product.sizes.first.name %>
              <%= form.hidden_field :type, value: product.types.first.name %>
              <%= form.hidden_field :product_id, value: product.id %>
              <%= form.hidden_field :quantity, value: 1 %>
              <%= form.submit 'Add to Cart', class: 'btn btn-primary' %>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div> 
</div>  
<div class="row categoryFooter">
  <div class="col-lg-offset-4 col-lg-8 ">
    <%= will_paginate(@productList, renderer: BootstrapPagination::Rails)%>
  </div>
</div>
